<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Klaro Test Page</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: system-ui, sans-serif; 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { color: #333; }
    h2 { color: #666; margin-top: 30px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
    
    .card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    label { display: block; margin: 10px 0 5px; font-weight: 500; }
    input[type="text"], input[type="email"], textarea, select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    input[type="checkbox"], input[type="radio"] { margin-right: 8px; }
    
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px 5px 5px 0;
    }
    .btn-primary { background: #007bff; color: white; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-primary:hover { background: #0056b3; }
    .btn-secondary:hover { background: #545b62; }
    .btn-success:hover { background: #1e7e34; }
    .btn-danger:hover { background: #c82333; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .status { 
      padding: 10px; 
      border-radius: 4px; 
      margin: 10px 0;
      font-size: 14px;
    }
    .status.success { background: #d4edda; color: #155724; }
    .status.error { background: #f8d7da; color: #721c24; }
    .status.info { background: #d1ecf1; color: #0c5460; }
    
    /* Modal styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: white;
      border-radius: 8px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .modal h3 { margin-top: 0; }
    
    /* Dropdown */
    .dropdown { position: relative; display: inline-block; }
    .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 150px;
      z-index: 100;
    }
    .dropdown-menu.show { display: block; }
    .dropdown-menu button {
      display: block;
      width: 100%;
      text-align: left;
      background: none;
      border: none;
      padding: 10px 15px;
      margin: 0;
      border-radius: 0;
    }
    .dropdown-menu button:hover { background: #f5f5f5; }
    
    .counter { font-size: 24px; font-weight: bold; margin: 10px 0; }
    .hidden { display: none; }
    
    #dynamic-section { margin-top: 20px; }
    .dynamic-item {
      background: #e9ecef;
      padding: 10px 15px;
      margin: 5px 0;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>
  <h1>üß™ Klaro Test Page</h1>
  <p>Use this page to test reactive element tracking and state sync.</p>

  <!-- ===== SECTION 1: Basic Inputs ===== -->
  <h2>1. Input Sync (State Polling)</h2>
  <div class="card">
    <p>Type in these fields - they should sync to the accessible UI without LLM calls.</p>
    
    <label for="name">Name</label>
    <input type="text" id="name" placeholder="Enter your name">
    
    <label for="email">Email</label>
    <input type="email" id="email" placeholder="Enter your email">
    
    <label for="message">Message</label>
    <textarea id="message" rows="3" placeholder="Type a message..."></textarea>
    
    <label for="country">Country</label>
    <select id="country">
      <option value="">Select a country</option>
      <option value="us">United States</option>
      <option value="uk">United Kingdom</option>
      <option value="de">Germany</option>
      <option value="fr">France</option>
    </select>
  </div>

  <!-- ===== SECTION 2: Checkboxes & Toggles ===== -->
  <h2>2. Checkbox & Toggle Sync</h2>
  <div class="card">
    <label>
      <input type="checkbox" id="newsletter"> Subscribe to newsletter
    </label>
    <label>
      <input type="checkbox" id="terms"> I agree to terms and conditions
    </label>
    <label>
      <input type="checkbox" id="marketing" checked> Receive marketing emails
    </label>
    
    <div style="margin-top: 15px;">
      <strong>Notification preferences:</strong>
      <label><input type="radio" name="notif" value="all"> All notifications</label>
      <label><input type="radio" name="notif" value="important" checked> Important only</label>
      <label><input type="radio" name="notif" value="none"> None</label>
    </div>
  </div>

  <!-- ===== SECTION 3: Button State Changes ===== -->
  <h2>3. Dynamic Button States</h2>
  <div class="card">
    <p>Click buttons to see state changes (disabled/enabled, labels).</p>
    
    <button class="btn-primary" id="submit-btn" onclick="handleSubmit()">Submit Form</button>
    <button class="btn-secondary" id="loading-btn" onclick="simulateLoading(this)">Load Data</button>
    <button class="btn-success" id="toggle-btn" onclick="toggleButtonState()">Enable Feature</button>
    
    <div id="submit-status" class="status info hidden"></div>
  </div>

  <!-- ===== SECTION 4: Counter (Frequent Updates) ===== -->
  <h2>4. Counter (Polling Test)</h2>
  <div class="card">
    <p>Test that polling correctly syncs rapid value changes.</p>
    <div class="counter" id="counter-value">0</div>
    <button class="btn-primary" onclick="changeCounter(-1)">‚àí</button>
    <button class="btn-primary" onclick="changeCounter(1)">+</button>
    <button class="btn-secondary" onclick="resetCounter()">Reset</button>
    <button class="btn-success" id="auto-btn" onclick="toggleAutoIncrement()">Start Auto +1</button>
  </div>

  <!-- ===== SECTION 5: Dropdown Menu ===== -->
  <h2>5. Dropdown Menu</h2>
  <div class="card">
    <p>Click to show dropdown - tests minor additions (should NOT trigger LLM).</p>
    <div class="dropdown">
      <button class="btn-primary" onclick="toggleDropdown()">Actions ‚ñº</button>
      <div class="dropdown-menu" id="dropdown-menu">
        <button onclick="dropdownAction('edit')">‚úèÔ∏è Edit</button>
        <button onclick="dropdownAction('duplicate')">üìã Duplicate</button>
        <button onclick="dropdownAction('archive')">üì¶ Archive</button>
        <button onclick="dropdownAction('delete')">üóëÔ∏è Delete</button>
      </div>
    </div>
    <span id="dropdown-result" style="margin-left: 15px;"></span>
  </div>

  <!-- ===== SECTION 6: Modal Dialog ===== -->
  <h2>6. Modal Dialog (New Context)</h2>
  <div class="card">
    <p>Open a modal - this should trigger a "new context" and queue for LLM processing.</p>
    <button class="btn-primary" onclick="openModal('confirm')">Open Confirm Modal</button>
    <button class="btn-secondary" onclick="openModal('form')">Open Form Modal</button>
  </div>

  <!-- ===== SECTION 7: Dynamic Content ===== -->
  <h2>7. Dynamic Content (Add/Remove)</h2>
  <div class="card">
    <p>Add items dynamically - small additions should auto-add, large batches may queue.</p>
    <button class="btn-success" onclick="addItem()">+ Add Item</button>
    <button class="btn-primary" onclick="addManyItems(5)">+ Add 5 Items</button>
    <button class="btn-danger" onclick="clearItems()">Clear All</button>
    <div id="dynamic-section"></div>
  </div>

  <!-- ===== SECTION 8: Form Validation ===== -->
  <h2>8. Form with Validation</h2>
  <div class="card">
    <form id="test-form" onsubmit="handleFormSubmit(event)">
      <label for="username">Username (min 3 chars)</label>
      <input type="text" id="username" placeholder="Enter username" oninput="validateUsername()">
      <div id="username-error" class="status error hidden">Username must be at least 3 characters</div>
      
      <label for="password">Password (min 6 chars)</label>
      <input type="text" id="password" placeholder="Enter password" oninput="validatePassword()">
      <div id="password-error" class="status error hidden">Password must be at least 6 characters</div>
      
      <div style="margin-top: 15px;">
        <button type="submit" class="btn-primary" id="form-submit" disabled>Create Account</button>
        <button type="button" class="btn-secondary" onclick="resetForm()">Reset</button>
      </div>
    </form>
  </div>

  <!-- ===== MODALS ===== -->
  <div class="modal-overlay" id="confirm-modal" role="dialog" aria-modal="true" aria-label="Confirm Action">
    <div class="modal">
      <h3>Confirm Action</h3>
      <p>Are you sure you want to proceed with this action? This cannot be undone.</p>
      <button class="btn-danger" onclick="confirmAction()">Yes, Proceed</button>
      <button class="btn-secondary" onclick="closeModal('confirm')">Cancel</button>
    </div>
  </div>

  <div class="modal-overlay" id="form-modal" role="dialog" aria-modal="true" aria-label="Quick Form">
    <div class="modal">
      <h3>Quick Form</h3>
      <label for="modal-name">Your Name</label>
      <input type="text" id="modal-name" placeholder="Enter name">
      
      <label for="modal-feedback">Feedback</label>
      <textarea id="modal-feedback" rows="3" placeholder="Your feedback..."></textarea>
      
      <label>
        <input type="checkbox" id="modal-anonymous"> Submit anonymously
      </label>
      
      <div style="margin-top: 15px;">
        <button class="btn-primary" onclick="submitModalForm()">Submit</button>
        <button class="btn-secondary" onclick="closeModal('form')">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Counter =====
    let counterValue = 0;
    let autoInterval = null;
    
    function changeCounter(delta) {
      counterValue += delta;
      document.getElementById('counter-value').textContent = counterValue;
    }
    
    function resetCounter() {
      counterValue = 0;
      document.getElementById('counter-value').textContent = '0';
    }
    
    function toggleAutoIncrement() {
      const btn = document.getElementById('auto-btn');
      if (autoInterval) {
        clearInterval(autoInterval);
        autoInterval = null;
        btn.textContent = 'Start Auto +1';
        btn.className = 'btn-success';
      } else {
        autoInterval = setInterval(() => changeCounter(1), 1000);
        btn.textContent = 'Stop Auto +1';
        btn.className = 'btn-danger';
      }
    }
    
    // ===== Submit Button =====
    function handleSubmit() {
      const btn = document.getElementById('submit-btn');
      const status = document.getElementById('submit-status');
      
      btn.disabled = true;
      btn.textContent = 'Submitting...';
      
      setTimeout(() => {
        btn.textContent = 'Submit Form';
        btn.disabled = false;
        status.textContent = '‚úì Form submitted successfully!';
        status.className = 'status success';
      }, 2000);
    }
    
    function simulateLoading(btn) {
      const originalText = btn.textContent;
      btn.disabled = true;
      btn.textContent = 'Loading...';
      
      setTimeout(() => {
        btn.textContent = originalText;
        btn.disabled = false;
      }, 3000);
    }
    
    let featureEnabled = false;
    function toggleButtonState() {
      featureEnabled = !featureEnabled;
      const btn = document.getElementById('toggle-btn');
      btn.textContent = featureEnabled ? 'Disable Feature' : 'Enable Feature';
      btn.className = featureEnabled ? 'btn-danger' : 'btn-success';
    }
    
    // ===== Dropdown =====
    function toggleDropdown() {
      document.getElementById('dropdown-menu').classList.toggle('show');
    }
    
    function dropdownAction(action) {
      document.getElementById('dropdown-result').textContent = `Selected: ${action}`;
      document.getElementById('dropdown-menu').classList.remove('show');
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.dropdown')) {
        document.getElementById('dropdown-menu').classList.remove('show');
      }
    });
    
    // ===== Modals =====
    function openModal(type) {
      document.getElementById(`${type}-modal`).classList.add('show');
    }
    
    function closeModal(type) {
      document.getElementById(`${type}-modal`).classList.remove('show');
    }
    
    function confirmAction() {
      alert('Action confirmed!');
      closeModal('confirm');
    }
    
    function submitModalForm() {
      const name = document.getElementById('modal-name').value;
      const feedback = document.getElementById('modal-feedback').value;
      const anonymous = document.getElementById('modal-anonymous').checked;
      
      alert(`Submitted!\nName: ${anonymous ? '(anonymous)' : name}\nFeedback: ${feedback}`);
      closeModal('form');
    }
    
    // ===== Dynamic Content =====
    let itemCount = 0;
    
    function addItem() {
      itemCount++;
      const section = document.getElementById('dynamic-section');
      const item = document.createElement('div');
      item.className = 'dynamic-item';
      item.innerHTML = `
        <span>Item ${itemCount}</span>
        <button class="btn-danger" onclick="removeItem(this)" style="padding: 5px 10px;">Remove</button>
      `;
      section.appendChild(item);
    }
    
    function addManyItems(count) {
      for (let i = 0; i < count; i++) {
        addItem();
      }
    }
    
    function removeItem(btn) {
      btn.parentElement.remove();
    }
    
    function clearItems() {
      document.getElementById('dynamic-section').innerHTML = '';
      itemCount = 0;
    }
    
    // ===== Form Validation =====
    function validateUsername() {
      const input = document.getElementById('username');
      const error = document.getElementById('username-error');
      const valid = input.value.length >= 3;
      error.classList.toggle('hidden', valid);
      updateFormSubmit();
    }
    
    function validatePassword() {
      const input = document.getElementById('password');
      const error = document.getElementById('password-error');
      const valid = input.value.length >= 6;
      error.classList.toggle('hidden', valid);
      updateFormSubmit();
    }
    
    function updateFormSubmit() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const btn = document.getElementById('form-submit');
      btn.disabled = !(username.length >= 3 && password.length >= 6);
    }
    
    function handleFormSubmit(e) {
      e.preventDefault();
      alert('Account created successfully!');
    }
    
    function resetForm() {
      document.getElementById('test-form').reset();
      document.getElementById('username-error').classList.add('hidden');
      document.getElementById('password-error').classList.add('hidden');
      document.getElementById('form-submit').disabled = true;
    }
  </script>
</body>
</html>
